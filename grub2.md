# Working with GRUB 2
- The GRUB 2 configuration file ```grub.cfg``` location:
  - BIOS machines: ```/boot/grub2/grub.cfg``` 
  - UEFI machines: ```/boot/efi/EFI/redhat/grub.cfg```
- The GRUB 2 configuration file ```grub.cfg``` generation:
  - created during installation
  - regenerated by running the ```grub2-mkconfig``` command
    - according to the template files in ```/etc/grub.d/```, and custom settings in the ```/etc/default/grub``` file.
  - automatically updated by ```grubby``` each time a new kernel is installed
- Edits of ```grub.cfg``` will be lost any time ``grub2-mkconfig`` is used to regenerate the file.
- Any manual changes to ``/etc/default/grub`` require rebuilding the ```grub.cfg``` file. 

## Menu Entries in /boot/grub2/grub.cfg
```
### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-957.27.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-957.el7.x86_64-advanced-d56e708b-c5a8-451e-b190-91b5659039b3' {
	load_video
	set gfxpayload=keep
	insmod gzio
	insmod part_msdos
	insmod xfs
	set root='hd0,msdos1'
	if [ x$feature_platform_search_hint = xy ]; then
	  search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1'  a0fe573a-f15f-4828-a286-c00617359ca1
	else
	  search --no-floppy --fs-uuid --set=root a0fe573a-f15f-4828-a286-c00617359ca1
	fi
	linux16 /vmlinuz-3.10.0-957.27.2.el7.x86_64 root=/dev/mapper/centos-root ro crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet LANG=en_US.UTF-8
	initrd16 /initramfs-3.10.0-957.27.2.el7.x86_64.img
}
....
### END /etc/grub.d/10_linux ###
```

## grubby
The grubby tool can be used to read information from, and make persistent changes to, the `grub.cfg` file.
- To list all the kernel menu entries:
  ```
  $ grubby --info=ALL
  index=0
  kernel=/boot/vmlinuz-3.10.0-957.27.2.el7.x86_64
  args="ro crashkernel=auto rd.lvm.lv=cl_rh7/root rd.lvm.lv=cl_rh7/swap rhgb quiet LANG=en_US.UTF-8"
  root=/dev/mapper/cl_rh7-root
  initrd=/boot/initramfs-3.10.0-957.27.2.el7.x86_64.img
  title=CentOS Linux (3.10.0-957.27.2.el7.x86_64) 7 (Core)
  ....
  ```
- To view the GRUB 2 menu entry for a specific kernel:
  ```
  $ grubby --info /boot/vmlinuz-3.10.0-514.el7.x86_64
  ```
- To find out the file name of the default kernel:
  ```
  $ grubby --default-kernel
  /boot/vmlinuz-3.10.0-957.27.2.el7.x86_64
  ```
- To find out the index number of the default kernel:
  ```
  $ grubby --default-index
  0
  ```
- Changing the default boot entry persistently:
  ```
  $ grubby --set-default /boot/vmlinuz-3.10.0-514.el7.x86_64
  ```
- To add and remove arguments from a kernel, e.q.:
  ```
  $ grubby --remove-args="rhgb quiet" --args=console=ttyS0,38400 --update-kernel /boot/vmlinuz-3.10.0-957.27.2.el7.x86_64
  ```
- Changinig a kernel argument, e.q.:
  ```
  $ grubby --args=vconsole.font=latarcyrheb-sun32 --update-kernel /boot/vmlinuz-3.10.0-957.27.2.el7.x86_64
  ```

  ## grub2-set-default
  Changing the default boot entry:
  1. To list the available menu entries:
     ```
	 $ grubby --info=ALL
	 ``` 
  2. Set the default boot entry:
     ```
	 $ grub2-set-default <index number>
	 ``` 
  3. Changes to ``/etc/default/grub`` require rebuilding the ``grub.cfg`` file:
     - On BIOS-based machines:
       ```
	   $ grub2-mkconfig -o /boot/grub2/grub.cfg
	   ```
     - On UEFI-based machines:
       ```
	   $ grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
	   ```
	   